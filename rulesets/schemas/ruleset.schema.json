{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://quobix.com/vacuum/schemas/ruleset.schema.json",
  "type": "object",
  "properties": {
    "description": {
      "type": "string"
    },
    "extends": {
      "$ref": "#/definitions/Extends"
    },
    "aliases": {
      "type": "object",
      "propertyNames": {
        "pattern": "^[A-Za-z][A-Za-z\\d_-]*$",
        "x-errorMessage": {
          "pattern": "to avoid confusion the name must match /^[A-Za-z][A-Za-z\\d_-]*$/ regular expression",
          "minLength": "the name of an alias must not be empty"
        }
      },
      "additionalProperties": {
        "if": {
          "type": "object"
        },
        "then": {
          "type": "object",
          "required": [ "targets" ],
          "properties": {
            "description": {
              "type": "string"
            },
            "targets": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "required": [ "formats", "given" ],
                "properties": {
                  "formats": {
                    "$ref": "#/definitions/Formats"
                  },
                  "given": {
                    "$ref": "#/definitions/Given"
                  }
                },
                "x-errorMessage": "a valid target must contain given and non-empty formats"
              },
              "x-errorMessage": {
                "minItems": "targets must have at least a single alias definition"
              }
            }
          },
          "x-errorMessage": {
            "required": "targets must be present and have at least a single alias definition"
          }
        },
        "else": {
          "$ref": "#/definitions/Given"
        }
      }
    },
    "documentationUrl": {
      "type": "string",
      "format": "url",
      "x-errorMessage": "must be a valid URL"
    },
    "formats": {
      "$ref": "#/definitions/Formats"
    },
    "functions": {
      "$ref": "#/definitions/Functions"
    },
    "functionsDir": {
      "$ref": "#/definitions/FunctionsDir"
    },
    "overrides": {
      "type": "array",
      "minItems": 1,
      "items": {
        "if": {
          "type": "object",
          "required": [ "files" ],
          "properties": {
            "files": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "string",
                "pattern": "^[^#]+#",
                "minLength": 1
              },
              "x-errorMessage": "must be a non-empty array of glob patterns"
            }
          }
        },
        "then": {
          "type": "object",
          "required": [ "rules" ],
          "properties": {
            "files": true,
            "rules": {
              "type": "object",
              "additionalProperties": {
                "$ref": "#/definitions/Severity"
              },
              "x-errorMessage": {
                "enum": "must be a valid severity level"
              }
            }
          },
          "additionalProperties": false,
          "x-errorMessage": {
            "required": "must contain rules when JSON Pointers are defined",
            "additionalProperties": "must not override any other property than rules when JSON Pointers are defined"
          }
        },
        "else": {
          "type": "object",
          "required": [ "files" ],
          "properties": {
            "files": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "string",
                "pattern": "[^#]",
                "minLength": 1
              },
              "x-errorMessage": "must be a non-empty array of glob patterns"
            }
          },
          "x-errorMessage": {
            "type": "must be an override, i.e. { \"files\": [\"v2/**/*.json\"], \"rules\": {} }"
          },
          "anyOf": [
            {
              "required": [ "extends" ]
            },
            {
              "required": [ "rules" ]
            }
          ],
          "allOf": [
            {
              "type": "object",
              "properties": {
                "extends": {
                  "$ref": "#/properties/extends"
                },
                "aliases": {
                  "$ref": "#/properties/aliases"
                },
                "formats": {
                  "$ref": "#/definitions/Formats"
                },
                "parserOptions": {
                  "$ref": "#/properties/parserOptions"
                },
                "rules": {
                  "$ref": "#/properties/rules"
                }
              }
            }
          ]
        }
      },
      "x-errorMessage": {
        "minItems": "must not be empty"
      }
    },
    "parserOptions": {
      "type": "object",
      "properties": {
        "duplicateKeys": {
          "$ref": "#/definitions/Severity"
        },
        "incompatibleValues": {
          "$ref": "#/definitions/Severity"
        }
      },
      "additionalProperties": false
    },
    "rules": {
      "type": "object",
      "additionalProperties": {
        "oneOf": [
          {
            "type": "object",
            "required": [ "given", "then" ],
            "properties": {
              "id": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "type": {
                "enum": [ "style", "validation" ],
                "x-errorMessage": "allowed types are \"style\" and \"validation\""
              },
              "then": {
                "anyOf": [
                  {
                    "$ref": "#/definitions/Then"
                  },
                  {
                    "type": "array",
                    "items": {
                      "$ref": "#/definitions/Then"
                    }
                  }
                ]
              },
              "category": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string"
                      },
                      "description": {
                        "type": "string"
                      },
                      "name": {
                        "type": "string"
                      }
                    }
                  }
                ]
              },
              "documentationUrl": {
                "type": "string",
                "format": "url",
                "x-errorMessage": "must be a valid URL"
              },
              "formats": {
                "$ref": "#/definitions/Formats"
              },
              "given": {
                "oneOf": [
                  {
                    "type": "string"
                  },
                  {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                ]
              },
              "howToFix": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "recommended": {
                "type": "boolean"
              },
              "resolved": {
                "type": "boolean"
              },
              "severity": {
                "$ref": "#/definitions/Severity"
              },
              "tags": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "autoFixFunction": {
                "type": "string"
              }
            },
            "additionalProperties": false,
            "x-errorMessage": {
              "required": "the rule must have at least \"given\" and \"then\" properties"
            }
          },
          {
            "$ref": "#/definitions/HumanReadableSeverity"
          },
          {
            "type": "boolean"
          }
        ]
      }
    }
  },
  "additionalProperties": false,
  "definitions": {
    "DiagnosticSeverity": {
      "enum": [ -1, 0, 1, 2, 3 ]
    },
    "Extends": {
      "x-$anchor": "extends",
      "oneOf": [
        {
          "type": "string"
        },
        {
          "type": "array",
          "items": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "array",
                "minItems": 2,
                "items": [
                  {
                    "type": "string"
                  },
                  {
                    "enum": [ "all", "recommended", "off" ],
                    "x-errorMessage": "allowed types are \"off\", \"recommended\" and \"all\""
                  }
                ],
                "additionalItems": false
              }
            ]
          }
        }
      ]
    },
    "Format": {
      "x-$anchor": "format",
      "x-errorMessage": "must be a valid format",
      "x-spectral-runtime": "spectral-format"
    },
    "Formats": {
      "x-$anchor": "formats",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Format"
      },
      "x-errorMessage": "must be an array of formats"
    },
    "Function": {
      "x-$anchor": "function",
      "type": "object",
      "required": [ "function" ],
      "properties": {
        "function": {
          "type": "string"
        }
      }
    },
    "Functions": {
      "x-$anchor": "functions",
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "FunctionsDir": {
      "x-$anchor": "functionsDir",
      "type": "string"
    },
    "Given": {
      "x-$anchor": "given",
      "if": {
        "type": "array"
      },
      "then": {
        "x-$anchor": "arrayish-given",
        "type": "array",
        "minItems": 1,
        "items": {
          "$ref": "#/definitions/PathExpression"
        },
        "x-errorMessage": {
          "minItems": "must be a non-empty array of expressions"
        }
      },
      "else": {
        "$ref": "#/definitions/PathExpression"
      }
    },
    "HumanReadableSeverity": {
      "enum": [ "error", "warn", "info", "hint", "off" ]
    },
    "PathExpression": {
      "$id": "path-expression",
      "type": "string",
      "pattern": "^[$#]",
      "x-errorMessage": "must be a valid JSON Path expression or a reference to the existing Alias optionally paired with a JSON Path expression subset"
    },
    "Severity": {
      "x-$anchor": "severity",
      "oneOf": [
        {
          "$ref": "#/definitions/DiagnosticSeverity"
        },
        {
          "$ref": "#/definitions/HumanReadableSeverity"
        }
      ],
      "x-errorMessage": "the value has to be one of: 0, 1, 2, 3 or \"error\", \"warn\", \"info\", \"hint\", \"off\""
    },
    "Then": {
      "type": "object",
      "properties": {
        "field": {
          "type": "string"
        },
        "autoFixFunction": {
          "type": "string"
        }
      },
      "required": [ "function" ],
      "x-spectral-runtime": "ruleset-function",
      "allOf": [
        {
          "type": "object"
        }
      ]
    }
  }
}
